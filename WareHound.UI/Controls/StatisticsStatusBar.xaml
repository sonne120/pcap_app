<UserControl x:Class="WareHound.UI.Controls.StatisticsStatusBar"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:scottplot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF">
    
    <UserControl.Resources>
        <!-- ===== COLORS - Using App's General Light Theme ===== -->
        <SolidColorBrush x:Key="BarBackgroundBrush" Color="#E8E8ED"/>
        <SolidColorBrush x:Key="BarBackgroundHoverBrush" Color="#D2D2D7"/>
        <SolidColorBrush x:Key="ExpandedBackgroundBrush" Color="#FFFFFF"/>
        <SolidColorBrush x:Key="CardBackgroundBrush" Color="#F5F5F7"/>
        <SolidColorBrush x:Key="StatusBarBorderBrush" Color="#D2D2D7"/>
        
        <SolidColorBrush x:Key="TextPrimaryBrush" Color="#3D3D44"/>
        <SolidColorBrush x:Key="TextSecondaryBrush" Color="#8E8E93"/>
        <SolidColorBrush x:Key="TextMutedBrush" Color="#AEAEB2"/>
        
        <SolidColorBrush x:Key="AccentBlueBrush" Color="#007AFF"/>
        <SolidColorBrush x:Key="AccentGreenBrush" Color="#34C759"/>
        <SolidColorBrush x:Key="AccentYellowBrush" Color="#FF9500"/>
        <SolidColorBrush x:Key="AccentPurpleBrush" Color="#AF52DE"/>
        <SolidColorBrush x:Key="AccentRedBrush" Color="#FF3B30"/>
        <SolidColorBrush x:Key="AccentTealBrush" Color="#5AC8FA"/>
        
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        
        <!-- ===== STYLES ===== -->
        
        <!-- Metric Style in Status Bar -->
        <Style x:Key="MetricStyle" TargetType="StackPanel">
            <Setter Property="Orientation" Value="Horizontal"/>
            <Setter Property="Margin" Value="0,0,20,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- Metric Icon Style -->
        <Style x:Key="MetricIconStyle" TargetType="Border">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <!-- Expanded Card Style -->
        <Style x:Key="ExpandedCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource CardBackgroundBrush}"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Margin" Value="4"/>
        </Style>
        
        <!-- Protocol Bar Style -->
        <Style x:Key="ProtocolBarStyle" TargetType="Border">
            <Setter Property="Height" Value="6"/>
            <Setter Property="CornerRadius" Value="3"/>
        </Style>
        
    </UserControl.Resources>
    
    <Border Background="{StaticResource BarBackgroundBrush}" 
            BorderBrush="{StaticResource StatusBarBorderBrush}" 
            BorderThickness="0,1,0,0">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <!-- ===== STATUS BAR (Always Visible) ===== -->
            <Border Grid.Row="0" 
                    Background="{StaticResource BarBackgroundBrush}"
                    Cursor="Hand"
                    MouseLeftButtonUp="StatusBar_Click"
                    MouseEnter="StatusBar_MouseEnter"
                    MouseLeave="StatusBar_MouseLeave"
                    x:Name="StatusBarBorder">
                <Grid Margin="16,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Left: Metrics -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        
                        <!-- Total Packets -->
                        <StackPanel Style="{StaticResource MetricStyle}">
                            <Border Style="{StaticResource MetricIconStyle}" Background="#3B82F620">
                                <Path Data="M4,4 L4,20 M4,20 L20,20 M8,16 L8,20 M12,12 L12,20 M16,8 L16,20" 
                                      Stroke="{StaticResource AccentBlueBrush}" 
                                      StrokeThickness="1.5"
                                      Width="14" Height="14" 
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding TotalPackets, FallbackValue='0'}" 
                                           Foreground="{StaticResource TextPrimaryBrush}" 
                                           FontWeight="SemiBold" 
                                           FontSize="14"/>
                                <TextBlock Text="packets" 
                                           Foreground="{StaticResource TextMutedBrush}" 
                                           FontSize="10" 
                                           Margin="0,-2,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Packets/sec -->
                        <StackPanel Style="{StaticResource MetricStyle}">
                            <Border Style="{StaticResource MetricIconStyle}" Background="#10B98120">
                                <Path Data="M2,12 L7,12 L10,4 L14,20 L17,12 L22,12" 
                                      Stroke="{StaticResource AccentGreenBrush}" 
                                      StrokeThickness="1.5"
                                      StrokeLineJoin="Round"
                                      Width="14" Height="14" 
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding PacketsPerSecond, FallbackValue='0.0'}" 
                                           Foreground="{StaticResource AccentGreenBrush}" 
                                           FontWeight="SemiBold" 
                                           FontSize="14"/>
                                <TextBlock Text="pps" 
                                           Foreground="{StaticResource TextMutedBrush}" 
                                           FontSize="10" 
                                           Margin="0,-2,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Data Volume -->
                        <StackPanel Style="{StaticResource MetricStyle}">
                            <Border Style="{StaticResource MetricIconStyle}" Background="#F59E0B20">
                                <Path Data="M12,2 L12,16 M8,6 L12,2 L16,6 M4,14 L4,20 L20,20 L20,14" 
                                      Stroke="{StaticResource AccentYellowBrush}" 
                                      StrokeThickness="1.5"
                                      StrokeLineJoin="Round"
                                      Width="14" Height="14" 
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding TotalDataSize, FallbackValue='0 B'}" 
                                           Foreground="{StaticResource TextPrimaryBrush}" 
                                           FontWeight="SemiBold" 
                                           FontSize="14"/>
                                <TextBlock Text="volume" 
                                           Foreground="{StaticResource TextMutedBrush}" 
                                           FontSize="10" 
                                           Margin="0,-2,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Capture Time -->
                        <StackPanel Style="{StaticResource MetricStyle}">
                            <Border Style="{StaticResource MetricIconStyle}" Background="#8B5CF620">
                                <Path Data="M12,2 A10,10 0 1,1 2,12 M12,6 L12,12 L16,14" 
                                      Stroke="{StaticResource AccentPurpleBrush}" 
                                      StrokeThickness="1.5"
                                      StrokeLineJoin="Round"
                                      Width="14" Height="14" 
                                      Stretch="Uniform"
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center">
                                <TextBlock Text="{Binding CaptureTime, FallbackValue='00:00:00'}" 
                                           Foreground="{StaticResource TextPrimaryBrush}" 
                                           FontWeight="SemiBold" 
                                           FontSize="14"/>
                                <TextBlock Text="duration" 
                                           Foreground="{StaticResource TextMutedBrush}" 
                                           FontSize="10" 
                                           Margin="0,-2,0,0"/>
                            </StackPanel>
                        </StackPanel>
                        
                        <!-- Separator -->
                        <Border Width="1" Height="28" Background="#D2D2D7" Margin="8,0,20,0"/>
                        
                        <!-- Mini Protocol Bar -->
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Width="120" Height="6" CornerRadius="3" Background="#D2D2D7" Margin="0,0,10,0">
                                <Border CornerRadius="3" ClipToBounds="True">
                                    <ItemsControl ItemsSource="{Binding MiniProtocolBars}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal"/>
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{Binding Color}" 
                                                        Width="{Binding Width}" 
                                                        Height="6"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Border>
                            </Border>
                            <TextBlock Foreground="{StaticResource TextMutedBrush}" FontSize="11" VerticalAlignment="Center">
                                <Run Text="{Binding TopProtocolName, FallbackValue='TLS'}" Foreground="{StaticResource AccentBlueBrush}"/>
                                <Run Text=" "/>
                                <Run Text="{Binding TopProtocolPercent, FallbackValue='0%'}"/>
                            </TextBlock>
                        </StackPanel>
                        
                    </StackPanel>
                    
                    <!-- Right: Expand Button -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Details" 
                                   Foreground="{StaticResource TextMutedBrush}" 
                                   FontSize="11" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,8,0"/>
                        <Border Background="#D2D2D7" CornerRadius="4" Padding="6,4">
                            <Path x:Name="ExpandIcon" 
                                  Data="M6,9 L12,15 L18,9" 
                                  Stroke="{StaticResource TextSecondaryBrush}" 
                                  StrokeThickness="2"
                                  StrokeLineJoin="Round"
                                  Width="12" Height="8" 
                                  Stretch="Uniform">
                                <Path.RenderTransform>
                                    <RotateTransform x:Name="ExpandIconRotation" Angle="0" CenterX="6" CenterY="4"/>
                                </Path.RenderTransform>
                            </Path>
                        </Border>
                    </StackPanel>
                    
                </Grid>
            </Border>
            
            <!-- ===== EXPANDED PANEL (Opens below status bar) ===== -->
            <Border x:Name="ExpandedPanel" 
                    Grid.Row="1" 
                    Background="{StaticResource ExpandedBackgroundBrush}"
                    BorderBrush="{StaticResource StatusBarBorderBrush}"
                    BorderThickness="0,1,0,0"
                    Visibility="Collapsed">
                
                <Grid Margin="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" MinWidth="200"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- ===== GRAPH CARD ===== -->
                    <Border Grid.Column="0" Style="{StaticResource ExpandedCardStyle}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*" MinHeight="80"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Graph Header -->
                            <Grid Grid.Row="0" Margin="0,0,0,8">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M2,12 L7,12 L10,4 L14,20 L17,12 L22,12" 
                                          Stroke="{StaticResource AccentBlueBrush}" 
                                          StrokeThickness="1.5"
                                          Width="14" Height="14" 
                                          Stretch="Uniform"
                                          VerticalAlignment="Center" 
                                          Margin="0,0,6,0"/>
                                    <TextBlock Text="Packets/sec (last 60s)" 
                                               Foreground="{StaticResource TextSecondaryBrush}" 
                                               FontSize="11" 
                                               FontWeight="Medium"
                                               VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Border Background="#10B98120" CornerRadius="4" Padding="6,2" Margin="0,0,6,0">
                                        <TextBlock FontSize="10">
                                            <Run Text="Curr: " Foreground="{StaticResource TextMutedBrush}"/>
                                            <Run Text="{Binding CurrentPPS, FallbackValue='0'}" Foreground="{StaticResource AccentGreenBrush}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </Border>
                                    <Border Background="#3B82F620" CornerRadius="4" Padding="6,2" Margin="0,0,6,0">
                                        <TextBlock FontSize="10">
                                            <Run Text="Avg: " Foreground="{StaticResource TextMutedBrush}"/>
                                            <Run Text="{Binding AvgPPS, FallbackValue='0'}" Foreground="{StaticResource AccentBlueBrush}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </Border>
                                    <Border Background="#F59E0B20" CornerRadius="4" Padding="6,2">
                                        <TextBlock FontSize="10">
                                            <Run Text="Max: " Foreground="{StaticResource TextMutedBrush}"/>
                                            <Run Text="{Binding MaxPPS, FallbackValue='0'}" Foreground="{StaticResource AccentYellowBrush}" FontWeight="SemiBold"/>
                                        </TextBlock>
                                    </Border>
                                </StackPanel>
                            </Grid>
                            
                            <!-- ScottPlot Chart -->
                            <Border Grid.Row="1" CornerRadius="4" ClipToBounds="True" Background="#2D3748">
                                <scottplot:WpfPlot x:Name="PacketsChart" Background="Transparent"/>
                            </Border>
                            
                            <!-- Time Labels -->
                            <Grid Grid.Row="2" Margin="4,6,4,0">
                                <TextBlock Text="-60s" Foreground="{StaticResource TextMutedBrush}" FontSize="9" HorizontalAlignment="Left"/>
                                <TextBlock Text="-30s" Foreground="{StaticResource TextMutedBrush}" FontSize="9" HorizontalAlignment="Center"/>
                                <TextBlock Text="Now" Foreground="{StaticResource TextSecondaryBrush}" FontSize="9" FontWeight="Medium" HorizontalAlignment="Right"/>
                            </Grid>
                        </Grid>
                    </Border>
                    
                    <!-- ===== TOP IPs CARD ===== -->
                    <Border Grid.Column="1" Style="{StaticResource ExpandedCardStyle}" Width="200">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Header -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <Path Data="M12,2 A10,10 0 1,0 22,12 M12,8 L12,12 L15,15" 
                                      Stroke="{StaticResource AccentBlueBrush}" 
                                      StrokeThickness="1.5"
                                      Width="14" Height="14" 
                                      Stretch="Uniform"
                                      VerticalAlignment="Center" 
                                      Margin="0,0,6,0"/>
                                <TextBlock Text="Top IPs" 
                                           Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="11" 
                                           FontWeight="Medium"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- IP List -->
                            <ItemsControl Grid.Row="1" ItemsSource="{Binding TopTalkers}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,0,0,8">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <Grid Grid.Row="0" Margin="0,0,0,3">
                                                <TextBlock Text="{Binding IpAddress}" 
                                                           Foreground="#D1D5DB" 
                                                           FontSize="11" 
                                                           FontFamily="Consolas"/>
                                                <TextBlock Text="{Binding Percent, StringFormat={}{0:F1}%}" 
                                                           Foreground="{StaticResource AccentBlueBrush}" 
                                                           FontSize="10" 
                                                           FontWeight="SemiBold"
                                                           HorizontalAlignment="Right"/>
                                            </Grid>
                                            
                                            <Border Grid.Row="1" Background="#D2D2D7" CornerRadius="2" Height="4">
                                                <Border Background="{StaticResource AccentBlueBrush}" 
                                                        CornerRadius="2" 
                                                        HorizontalAlignment="Left"
                                                        Width="{Binding BarWidth}"/>
                                            </Border>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </Border>
                    
                    <!-- ===== PROTOCOLS CARD ===== -->
                    <Border Grid.Column="2" Style="{StaticResource ExpandedCardStyle}" Width="160">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Header -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                                <Path Data="M12,2 A10,10 0 1,0 22,12 L12,12 Z" 
                                      Fill="{StaticResource AccentBlueBrush}" 
                                      Width="14" Height="14" 
                                      Stretch="Uniform"
                                      VerticalAlignment="Center" 
                                      Margin="0,0,6,0"/>
                                <TextBlock Text="Protocols" 
                                           Foreground="{StaticResource TextSecondaryBrush}" 
                                           FontSize="11" 
                                           FontWeight="Medium"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                            
                            <!-- Protocol List -->
                            <ItemsControl Grid.Row="1" ItemsSource="{Binding Protocols}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,0,0,6">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            
                                            <Border Grid.Column="0" 
                                                    Width="10" Height="10" 
                                                    CornerRadius="2" 
                                                    Background="{Binding Color}" 
                                                    Margin="0,0,8,0"
                                                    VerticalAlignment="Center"/>
                                            
                                            <TextBlock Grid.Column="1" 
                                                       Text="{Binding Name}" 
                                                       Foreground="#D1D5DB" 
                                                       FontSize="11"
                                                       VerticalAlignment="Center"/>
                                            
                                            <TextBlock Grid.Column="2" 
                                                       Text="{Binding Percent, StringFormat={}{0:F1}%}" 
                                                       Foreground="{StaticResource TextPrimaryBrush}" 
                                                       FontSize="11" 
                                                       FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </Border>
                    
                </Grid>
            </Border>
            
        </Grid>
    </Border>
</UserControl>
